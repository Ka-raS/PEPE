{% extends 'base.html' %}

{% block title %}Trang chủ{% endblock %}

{% block main %}

<div class="container mt-4">
  <div class="row g-4">
    <div class="col-lg-8">
      
      <!-- Gợi ý cho bạn -->
      <div class="card shadow-sm mb-4 border-0 rounded-card">
        <div class="card-header bg-primary text-white rounded-card-header">
          <h5 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Gợi ý cho bạn</h5>
        </div>
        <div class="card-body">
          <p class="text-muted">Một số tài liệu mới được tải lên:</p>
          <div class="list-group">
            {% for post in suggested_posts %}
            <a href="{% url 'forum:post_detail' post.id %}" class="list-group-item list-group-item-action border-0 rounded-list-item">
              <div class="d-flex w-100 justify-content-between">
                <h6 class="mb-1"><i class="bi bi-file-earmark-text me-1"></i>{{ post.title }}</h6>
                <small class="text-muted">{{ post.updated_at }}</small>
              </div>
              <p class="mb-1 small">{{ post.content|truncatewords:20 }}</p>
              {% if post.subject %}<span class="badge bg-secondary">{{ post.subject }}</span>{% endif %}
            </a>
            {% empty %}
            <p class="text-center text-muted p-3">Chưa có tài liệu nào phù hợp.</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Bài đăng nổi bật -->
      <div class="card shadow-sm mb-4 border-0 rounded-card">
        <div class="card-header bg-warning text-dark rounded-card-header">
          <h5 class="mb-0"><i class="bi bi-star-fill me-2"></i>Bài đăng nổi bật</h5>
        </div>
        <ul class="list-group list-group-flush">
          {% for post in popular_posts %}
          <li class="list-group-item p-3 d-flex align-items-start border-0">
            {% if post.author_avatar_path %}
              <img src="{{ post.author_avatar_path }}" class="rounded-circle me-3" alt="avatar" style="width: 40px; height: 40px; object-fit: cover;">
            {% else %}
              <div class="bg-secondary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
              <i class="bi bi-person-fill"></i>
              </div>
            {% endif %}

            <div class="flex-grow-1">
              <a href="{% url 'forum:post_detail' post.id %}" class="text-decoration-none fw-bold text-dark">{{ post.title }}</a>
              <div class="small text-muted mt-1">
                bởi {{ post.username }} • {{ post.created_at }} • trong <span class="badge bg-secondary">{{ post.subject_name }}</span>
              </div>
            </div>
            <div class="text-end small text-muted ms-3">
              <div><i class="bi bi-chat-dots-fill me-1"></i>{{ post.comment_count }}</div>
              <div><i class="bi bi-hand-thumbs-up-fill me-1"></i>{{ post.vote_value }}</div>
            </div>
          </li>
          {% empty %}
          <li class="list-group-item p-3 text-center text-muted">Chưa có bài đăng nổi bật.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Bài đăng mới nhất -->
      <div class="card shadow-sm mb-4 border-0 rounded-card">
        <div class="card-header bg-info text-white rounded-card-header">
          <h5 class="mb-0"><i class="bi bi-newspaper me-2"></i>Bài đăng mới nhất</h5>
        </div>
        <ul class="list-group list-group-flush">
          {% for post in latest_posts %}
          <li class="list-group-item p-3 d-flex align-items-start border-0">
            {% if post.author_avatar_path %}
              <img src="{{ post.author_avatar_path }}" class="rounded-circle me-3" alt="avatar" style="width: 40px; height: 40px; object-fit: cover;">
            {% else %}
              <div class="bg-secondary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
              <i class="bi bi-person-fill"></i>
              </div>
            {% endif %}

            <div class="flex-grow-1">
              <a href="{% url 'forum:post_detail' post.id %}" class="text-decoration-none fw-bold text-dark">{{ post.title }}</a>
              <div class="small text-muted mt-1">
                bởi {{ post.username }} • {{ post.created_at }} • trong <span class="badge bg-secondary">{{ post.subject_name }}</span>
              </div>
            </div>
            <div class="text-end small text-muted ms-3">
              <div><i class="bi bi-chat-dots-fill me-1"></i>{{ post.comment_count }}</div>
              <div><i class="bi bi-hand-thumbs-up-fill me-1"></i>{{ post.vote_value }}</div>
            </div>
          </li>
          {% empty %}
          <li class="list-group-item p-3 text-center text-muted">Chưa có bài đăng nổi bật.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Bài kiểm tra mới nhất -->
      <div class="card shadow-sm border-0 rounded-card">
        <div class="card-header bg-success text-white rounded-card-header">
          <h5 class="mb-0"><i class="bi bi-clipboard-check me-2"></i>Bài kiểm tra mới nhất</h5>
        </div>
        <ul class="list-group list-group-flush">
          {% for test in latest_tests %}
          <li class="list-group-item p-3 d-flex justify-content-between align-items-start border-0">
            {% if test.author_avatar_path %}
              <img src="{{ test.author_avatar_path }}" class="rounded-circle me-3" alt="avatar" style="width: 40px; height: 40px; object-fit: cover;">
            {% else %}
              <div class="bg-secondary text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
              <i class="bi bi-person-fill"></i>
              </div>
            {% endif %}

            <div class="flex-grow-1">
              <a href="{% url 'forum:test_detail' test.id %}" class="text-decoration-none fw-bold text-dark">
                <i class="bi bi-pencil-square me-1"></i>{{ test.title }}
              </a>
              {% if test.description %}<p class="mb-1 small text-muted">{{ test.description|truncatewords:15 }}</p>{% endif %}
              <div class="small text-muted mt-2">
                <span class="badge bg-secondary">{{ test.subject_name }}</span>
                <span class="ms-2"><i class="bi bi-person me-1"></i>{{ test.author_name }}</span>
                {% if test.time_limit %}<span class="ms-2"><i class="bi bi-clock me-1"></i>{{ test.time_limit }} phút</span>{% endif %}
                <span class="ms-2"><i class="bi bi-question-circle me-1"></i>{{ test.question_count }} câu hỏi</span>
              </div>
              {% if test.ends_at %}
              <div class="small text-danger mt-1">
                <i class="bi bi-calendar-event me-1"></i>Hạn: {{ test.ends_at }}
              </div>
              {% endif %}
            </div>
            <small class="text-muted ms-3">{{ test.created_at }}</small>
          </li>
          {% empty %}
          <li class="list-group-item p-3 text-center text-muted">Chưa có bài kiểm tra nào.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="sticky-top" style="top: 20px;">
        <div class="d-grid gap-4">
        
          <!-- Quick Actions -->
          <div class="card shadow-sm border-0 rounded-card">
            <div class="card-header bg-primary text-white rounded-card-header">
              <h5 class="card-title mb-0">
                <i class="bi bi-lightning"></i> Hành động nhanh
              </h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <a href="{% url 'forum:create_post' %}" class="btn btn-outline-primary rounded-btn">
                  <i class="bi bi-pencil"></i> Viết bài mới
                </a>
                <a href="{% url 'forum:index' %}" class="btn btn-outline-info rounded-btn">
                  <i class="bi bi-chat-dots me-1"></i> Diễn đàn
                </a>
              </div>                
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}